<!DOCTYPE html>
<html>

<head>
  <title>Mongolia Map with D3.js</title>
  <style>
    body,
    html {
      height: 100%;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: white;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .region {
      stroke: #000;
      stroke-width: 0.5;
    }

    .popover {
      position: absolute;
      text-align: left;
      width: auto;
      padding: 10px;
      background: white;
      border: 1px solid #ccc;
      pointer-events: none;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .popover h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
    }

    .popover ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    .popover ul li {
      margin: 0;
      padding: 0;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="map" id="map"></div>
  <div class="popover" id="popover" style="display: none;"></div>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://d3js.org/topojson.v1.min.js"></script>
  <script>
    // Set dimensions for the map
    const width = window.innerWidth;
    const height = window.innerHeight;

    // Create an SVG element
    const svg = d3.select("#map")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // Create a projection and path generator
    const projection = d3.geoMercator()
      .center([103.8467, 46.8625])
      .scale(2500)
      .translate([width / 2, height / 2]);

    const path = d3.geoPath().projection(projection);

    // Function to generate random colors
    function getRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    // Sample data: candidate information per region
    const candidateData = {
      "Khentii": [
        { name: "Candidate A", votes: 12345 },
        { name: "Candidate B", votes: 9876 },
        { name: "Candidate C", votes: 5432 }
      ],
      "Umnugovi": [
        { name: "Candidate D", votes: 23456 },
        { name: "Candidate E", votes: 8765 },
        { name: "Candidate F", votes: 4321 }
      ]
      // Add more regions and candidates as needed
    };

    // Function to create the popover content
    function createPopoverContent(region) {
      const candidates = candidateData[region.properties.prefecture] || [];
      const content = `<h4>${region.properties.prefecture}</h4>
                             <ul>
                                 ${candidates.slice(0, 3).map(candidate => `<li>${candidate.name}: ${candidate.votes} votes</li>`).join('')}
                             </ul>`;
      return content;
    }

    // Load and display the GeoJSON data
    d3.json('https://raw.githubusercontent.com/Bilgee/mongolia-geojson/master/mongolia.prefectures.geojson').then(data => {
      svg.selectAll("path")
        .data(data.features)
        .enter()
        .append("path")
        .attr("class", "region")
        .attr("d", path)
        .attr("fill", getRandomColor)
        .on("mouseover", function (event, d) {
          console.log(d);
          d3.select(this).attr("fill", "orange");
          const popover = d3.select("#popover");
          popover.html(createPopoverContent(d))
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY + 10) + "px")
            .style("display", "block");
        })
        .on("mouseout", function (event, d) {
          d3.select(this).attr("fill", getRandomColor);
          d3.select("#popover").style("display", "none");
        });
    });
  </script>
</body>

</html>